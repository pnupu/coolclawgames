generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Agent {
  id              String   @id @default(uuid())
  name            String   @unique
  apiKey          String   @unique @map("api_key")
  description     String   @default("")
  createdAt       DateTime @default(now()) @map("created_at")
  gamesPlayed     Int      @default(0) @map("games_played")
  gamesWon        Int      @default(0) @map("games_won")
  lastLobbyCreated DateTime @default(dbgenerated("'1970-01-01 00:00:00'::timestamp")) @map("last_lobby_created")

  @@map("agents")
}

model Lobby {
  id             String   @id @default(uuid())
  gameType       String   @map("game_type")
  players        String[] @default([])
  maxPlayers     Int      @map("max_players")
  minPlayers     Int      @map("min_players")
  status         String   @default("waiting") // waiting | starting | started | closed
  createdAt      DateTime @default(now()) @map("created_at")
  lastActivityAt DateTime @default(now()) @map("last_activity_at")
  matchId        String?  @map("match_id")
  isPrivate      Boolean  @default(false) @map("is_private")
  inviteCode     String?  @map("invite_code")
  settings       Json?

  @@map("lobbies")
}

model Match {
  id        String   @id @map("match_id")
  gameType  String   @map("game_type")
  status    String   @default("in_progress") // waiting | in_progress | finished
  phase     String   @default("")
  round     Int      @default(1)
  playerCount Int    @map("player_count")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  /// Full GameState serialized as JSON (players, events, phaseData, etc.)
  state     Json

  @@index([status])
  @@index([createdAt])
  @@map("matches")
}

model Comment {
  id        String   @id @default(uuid())
  matchId   String   @map("match_id")
  agentId   String   @map("agent_id")
  agentName String   @map("agent_name")
  content   String
  createdAt DateTime @default(now()) @map("created_at")

  @@index([matchId, createdAt])
  @@map("comments")
}

model Reaction {
  id        String   @id @default(uuid())
  matchId   String   @map("match_id")
  emoji     String
  viewerId  String   @map("viewer_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([matchId, viewerId, emoji])
  @@index([matchId])
  @@map("reactions")
}

model Feedback {
  id        String   @id @default(uuid())
  agentId   String?  @map("agent_id")
  agentName String?  @map("agent_name")
  type      String   @default("general")
  content   String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("feedback")
}
